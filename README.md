# 浅谈web3世界的秘密

## 智能合约

###### 智能：可执行，独立不受干扰

###### 合约：协议规则

总结：智能合约是一种将条款和条件转化为代码工具，自动执行并在区块链上进行记录，这种自动化和去中心化的特性使得职能合约在许多领域有广泛的应用。



## 账户

###### EOA账户：外部账户，由私钥控制，不可恢复

###### 合约账户：代码控制

EOA账户和合约账户中都有的共同特性

 1. nonce：一个计数器，用于表示账户发起的交易数量

    对于外部账户，nonce用于防止重放攻击，即同一笔交易被多次执行

    对于合约账户，nonce通常表示合约创建后已经调用的交易次数

    不管外部账户还是合约账户，没次发送交易时，nonce都会递增，确保交易顺序的唯一性

 2. balance：表示账户中的以太币的余额

    账户在网络中的经济状态，决定了账户能够进行交易和操作，余额的变动通常是通过转帐或者调用合约发生变化

 3. storageRoot：账户存储状态的merkle树根哈希值

    合约内部存储状态，包括所有键值对的存储，通过merkle树，可以快速验证存储的完整性和一致性

 4. code Hash：合约账户的字节码的哈希值

    用于标识合约的代码，并确保代码的一致性，如果代码发生变化，codehash也会改变，可以用来验证合约的版本

    

总结：EOA账户通过私钥控制，而合约账户的行为由合约内部的逻辑代码控制，EOA主要用于发送和接受交易，合约账户则可以进行复杂的业务逻辑和自动化操作，EOA账户仅有余额和nonce，合约账户有复杂的状态和存储机制。

<img src="https://p.ipic.vip/1f27qo.png" alt="image-20241104114435271" style="zoom: 25%;" />



## 钱包

###### 功能：用于管理EVM账号的助记词和私钥，发起交易和对交易进行签名

常用的钱包：metamask、imtoken、TrustWallet



## EVM

<img src="https://p.ipic.vip/8s7kvr.png" alt="image-20241104150320934" style="zoom:25%;" />

##### gas手续费

1. EIP 1559 提案前：Total Fee = Gas Limit * Gas Price

   矿工收益 = Total Fee

2. EIP 1559 提案后：Total Fee = Gas Limit * (Max Fee+Max Priority Fee)

   矿工收益（Tips） = Gas Limit×Max Priority Fee

   EIP提案主要解决的问题：

   	1. 避免矿工作恶
   	1. 降低通胀
   	1. 体验改善（base fee 扣实际的消耗，用户不用担心被多收费（之前用户需频繁地调整 gas ，或支付过高费用））



## 智能合约结构

## 「变量、函数、事件event、错误error、结构体、枚举、库、接口」

### 1.变量
####   格式：变量类型[可见性][可变状态]变量名称[赋值];
#####      变量类型：值类型、引用类型、映射类型
######            值类型：布尔类型、整形、定长浮点型、定长字节数组、枚举、地址类型
######            引用类型：数组、结构体
######            映射类型：mapping
#####       可见性：public ｜ private ｜ internal
#####       可变状态：constant(不可修改的变量，使用硬编码) ｜ immutable（不可修改的变量，在构造时赋值） 


### 2.函数
####   格式：function[可见性][可变状态]变量名称[赋值];

